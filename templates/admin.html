{% extends "base.html" %}
{% block title %}–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
    <h2>üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>

    <!-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è -->
    <form method="get">
        <label>–¶–µ–ª–µ–≤–∞—è –≤–∞–ª—é—Ç–∞:
            <select name="target_currency">
                <option value="USD" {% if target_currency =='USD' %}selected{% endif %}>USD</option>
                <option value="EUR" {% if target_currency =='EUR' %}selected{% endif %}>EUR</option>
                <option value="RUB" {% if target_currency =='RUB' %}selected{% endif %}>RUB</option>
            </select>
        </label>

        <label>–ü–æ–∏—Å–∫:
            <input type="text" name="search" value="{{ search }}" placeholder="–ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
        </label>

        <label>–§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
            <select name="user_filter">
                <option value="">–í—Å–µ</option>
                {% for u in users %}
                    <option value="{{ u }}" {% if user_filter == u %}selected{% endif %}>{{ u }}</option>
                {% endfor %}
            </select>
        </label>

        <label>–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
            <select name="category_filter">
                <option value="">–í—Å–µ</option>
                {% for c in categories %}
                    <option value="{{ c }}" {% if category_filter == c %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
        </label>

        <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </form>

    <p><strong>–ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π:</strong> {{ total }}</p>

    {% if expenses %}
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                <th>–°—É–º–º–∞</th>
                <th>–í–∞–ª—é—Ç–∞</th>
                <th>–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ {{ target_currency }}</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th>–î–∞—Ç–∞</th>
                <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
            </tr>
            </thead>
            <tbody>
            {% for expense in expenses %}
                <tr>
                    <td>{{ expense.id }}</td>
                    <td>{{ expense.user }}</td>
                    <td>{{ expense.amount }}</td>
                    <td>{{ expense.currency }}</td>
                    <td>{{ '%0.2f'|format(expense.converted_amount) }}</td>
                    <td>{{ expense.category }}</td>
                    <td>{{ expense.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>
                        <form action="/delete_expense/{{ expense.id }}" method="post">
                            <button type="submit" class="delete-button">–£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        <div style="margin-top: 20px;">
            {% set prev_page = current_page - 1 %}
            {% set next_page = current_page + 1 %}

            {% if current_page > 1 %}
                <a href="?page={{ prev_page }}&search={{ search }}&user_filter={{ user_filter }}&category_filter={{ category_filter }}">&laquo; –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            {% endif %}

            &nbsp;&nbsp;
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ current_page }} –∏–∑ {{ total_pages }}
            &nbsp;&nbsp;

            {% if current_page < total_pages %}
                <a href="?page={{ next_page }}&search={{ search }}&user_filter={{ user_filter }}&category_filter={{ category_filter }}">–°–ª–µ–¥—É—é—â–∞—è &raquo;</a>
            {% endif %}
        </div>
    {% else %}
        <p>–ó–∞–ø–∏—Å–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
    {% endif %}
{% endblock %}